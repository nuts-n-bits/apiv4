syntax = "proto3";

package apiv4.user;
import "support.proto";

message User_public_model {

    string id_bis = 1;
    string creation_time_iso = 2;
    string id_name = 3;
    string display_name = 4;
    string event_id_bis = 5;
    string language_code = 6;
    bool locked = 7;
    string locked_type_bis = 8;
    bool bot = 9;
    repeated string groups = 10;
    repeated string tags = 11;
    repeated string activities = 12;
}

message User_private_model {

    User_public_model public_model = 1;
    string email = 2;
    string last_password_update_iso = 4;
    repeated string bookmarks = 5;
}

// login

message Request_credential_by_password_naive_attempt {

    string user_name_normalized = 1;
    string user_email_primary = 2;
    string mhkd8192 = 3;
    uint32 require_expiry_in_seconds = 4;
}

message Response_2fa_hmac_totp_required_to_obtain_credential {

    string target_uid_bis = 1;
    string intermediate_access_grant_token = 2;
    string expiry_iso = 3;
}

message Request_credential_2fa_hmac_totp_code {

    string target_uid_bis = 1;
    string intermediate_access_grant_token = 2;
    string totp_token = 3;
}

message Response_2fa_mail_otp_step_0_verify_email_addr {

    string target_uid_bis = 1;
    string intermediate_access_grant_token = 2;
    string email_hint = 3;
    string expiry_iso = 4;
}

message Request_credential_mail_otp_step_0_response {
    
    string target_uid_bis = 1;
    string intermediate_access_grant_token = 2;
    string full_email = 3;
}

message Response_2fa_mail_otp_step_1_mail_sent {

    string expiry_iso = 1;
}

message Request_credential_mail_otp_step_1_response {

    string target_uid_bis = 1;
    string intermediate_access_grant_token = 2;
    string mail_token = 3;
}

message Request_credential_by_secure_link {
    string secure_link_entropy = 1;
}

message Response_credential_granted {

    string sid = 1;
    string ssec = 2;
    string expiry_iso = 3;
}

message Request_create_user_naive_attempt {

    string identifying_name = 1;
    string display_name = 2;
    string email_primary = 3;
    string mhkd8192 = 4;
}

message Response_user_created {
    
    string user_id_bis = 1;
    string sid_bis = 2;
    string ssec = 3;
    string expiry_iso = 4;
}

message Request_user_model_by_session {
    
    string sid = 1;
    string ssec = 2;
    
    int32 get_group = 3;
    bool get_group_new_to_old = 4;
    string get_group_start_point = 5;

    int32 get_tags = 6;
    bool get_tags_new_to_old = 7;
    string get_tags_start_point = 8;

    int32 get_activities = 9;
    bool get_activities_new_to_old = 10;
    string get_activities_start_point = 11;
}

message Response_user_model_by_session {
    User_private_model model = 1;
}

message Request_user_model_by_identifier {
    
    oneof identifier {
        string id_bis = 1;
        string email = 2;
        string id_name = 3;
    }

}

message Response_user_model_by_identifier {
    User_public_model model = 1;
}

message Session_validity_heartbeat_request {
    string sid = 1;
    string ssec = 2;
}

message Request_invalidate_session {
    string sid = 1;
    string ssec = 2;
}